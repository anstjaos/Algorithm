```java
class Solution {
    private HashMap<Long, Integer> memo = new HashMap<>();

    private int solve(long n) {
        if (n == 1) return 0;
        if (memo.containsKey(n)) return memo.get(n);

        int even = Integer.MAX_VALUE;
        int oddMinus = Integer.MAX_VALUE;
        int oddPlus = Integer.MAX_VALUE;

        if (n % 2 == 0) {
            even = 1 + solve(n / 2);
        } else {
            oddMinus = 1 + solve(n - 1);
            oddPlus = 1 + solve(n + 1);
        }

        int result = Math.min(even, Math.min(oddMinus, oddPlus));
        memo.put(n, result);
        return result;
    }

    public int integerReplacement(int n) {
        return solve(n);
    }
}
```